---
import BlogLayout from '../../../layouts/BlogLayout.astro';
import Navbar from '../../../components/Navbar.astro';
import Footer from '../../../components/Footer.astro';
import BlogDetail from '../../../components/blog/BlogDetail.astro';
import { blogData } from '../../../data/blog';

export function getStaticPaths() {
  const paths: Array<{ params: { locale: string; slug: string } }> = [];
  
  // Generate paths for each locale and each blog post
  ['en', 'id'].forEach(locale => {
    const blog = blogData[locale];
    if (blog && blog.posts) {
      blog.posts.forEach(post => {
        paths.push({
          params: { locale, slug: post.slug }
        });
      });
    }
  });
  
  return paths;
}

const { locale, slug } = Astro.params || {};

if (!locale || !slug) {
  return Astro.redirect('/en/blog');
}

const blog = blogData[locale] || blogData['en'];
const post = blog?.posts?.find(p => p.slug === slug);

if (!post) {
  return Astro.redirect(`/${locale}/blog`);
}

const siteUrl = 'https://gilabs.id';
const canonical = `${siteUrl}/${locale}/blog/${slug}`;
const pageTitle = `${post.title} | Gilabs Software House`;
const pageDescription = post.excerpt || 'Read our latest insights on web development, mobile apps, and technology trends from Gilabs Software House.';
const keywords = locale === 'en'
	? 'web development, mobile app development, software development, software house, UI/UX design, SEO, technology trends, software agency'
	: 'pengembangan web, pengembangan aplikasi mobile, pengembangan software, software house, desain UI/UX, SEO, tren teknologi, agen software';
---

<BlogLayout 
	lang={locale} 
	title={pageTitle}
	description={pageDescription}
	canonical={canonical}
	keywords={keywords}
>
  <Navbar lang={locale} />
  <main class="pt-20">
    <BlogDetail post={post} lang={locale || 'en'} />
  </main>
  <Footer lang={locale} />
</BlogLayout>

