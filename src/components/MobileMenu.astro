---
import { X } from 'lucide-react';
import { getWhatsAppLink } from '../lib/utils';

const { lang } = Astro.props;

const links = [
  { href: getWhatsAppLink('navbar', lang), label: lang === 'en' ? 'Contact' : 'Kontak', external: true },
];

const currentPath = Astro.url.pathname;
const switchLangPath = currentPath.includes('/en') 
  ? currentPath.replace('/en', '/id') 
  : currentPath.replace('/id', '/en');
---

<!-- Mobile Menu - Rendered directly in body to avoid parent transform issues -->
<div id="mobile-menu" class="fixed inset-0 bg-background/95 backdrop-blur-xl z-[9999] flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
  <!-- Close Button - Top Right -->
  <button 
    id="mobile-menu-close" 
    class="absolute top-4 right-4 sm:top-6 sm:right-6 p-2 text-foreground/60 hover:text-foreground transition-colors duration-200 group pointer-events-auto z-[10000]"
    aria-label="Close Menu"
  >
    <X className="w-5 h-5 sm:w-6 sm:h-6 stroke-[1.5] group-hover:stroke-[2] transition-all duration-200" />
  </button>
  
  <div class="flex flex-col items-center gap-8 text-center">
    {links.map(link => (
      <a 
        href={link.href} 
        class="text-2xl font-bold text-foreground hover:text-brand transition-colors mobile-link"
        {...(link.external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
      >
        {link.label}
      </a>
    ))}
    <div class="flex flex-col items-center gap-6 mt-8">
      <a href={switchLangPath} class="text-sm font-medium border border-border px-4 py-2 rounded-full hover:bg-secondary transition-colors uppercase">
        {lang === 'en' ? 'Switch to ID' : 'Ganti ke EN'}
      </a>
      <a href={getWhatsAppLink('navbar', lang)} target="_blank" rel="noopener noreferrer" class="text-lg font-bold bg-brand text-white px-8 py-3 rounded-full hover:bg-brand/90 transition-all shadow-lg shadow-brand/20">
        {lang === 'en' ? 'Get Started' : 'Mulai Sekarang'}
      </a>
    </div>
  </div>
</div>

<script>
  // Mobile menu toggle functionality
  // This script connects the toggle button in Navbar with the menu in body
  const menuToggle = document.getElementById('menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const iconMenu = document.getElementById('icon-menu');
  const iconClose = document.getElementById('icon-close');
  const mobileLinks = document.querySelectorAll('.mobile-link');

  function toggleMenu() {
    if (!mobileMenu || !iconMenu || !iconClose) return;
    
    const isClosed = mobileMenu.classList.contains('opacity-0');
    
    if (isClosed) {
      mobileMenu.classList.remove('opacity-0', 'pointer-events-none');
      if (iconMenu) iconMenu.classList.add('hidden');
      if (iconClose) iconClose.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      // Prevent scroll on body
      document.body.style.position = 'fixed';
      document.body.style.width = '100%';
    } else {
      mobileMenu.classList.add('opacity-0', 'pointer-events-none');
      if (iconMenu) iconMenu.classList.remove('hidden');
      if (iconClose) iconClose.classList.add('hidden');
      // Reset body styles
      document.body.style.overflow = '';
      document.body.style.position = '';
      document.body.style.width = '';
    }
  }

  // Close button handler
  const closeButton = document.getElementById('mobile-menu-close');
  
  // Wait for DOM to be ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      menuToggle?.addEventListener('click', toggleMenu);
      closeButton?.addEventListener('click', toggleMenu);
      mobileLinks.forEach(link => {
        link.addEventListener('click', toggleMenu);
      });
    });
  } else {
    menuToggle?.addEventListener('click', toggleMenu);
    closeButton?.addEventListener('click', toggleMenu);
    mobileLinks.forEach(link => {
      link.addEventListener('click', toggleMenu);
    });
  }
</script>
